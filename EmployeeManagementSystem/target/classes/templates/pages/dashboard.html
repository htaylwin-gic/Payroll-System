<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/base}">
<head>
    <title>Dashboard</title>
    
    <!-- Page-specific CSS -->
    <th:block layout:fragment="styles">
        <style>
            .stat-card { 
                border-left: 5px solid; 
                padding: 1.5rem; 
                background: white;
                border-radius: 16px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
                transition: all 0.3s ease;
                height: 100%;
            }
            .stat-card:hover { 
                transform: translateY(-5px); 
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            }
            .stat-card.total { border-left-color: #3b82f6; }
            .stat-card.active { border-left-color: #10b981; }
            .stat-card.leave { border-left-color: #f59e0b; }
            .stat-card.new { border-left-color: #06b6d4; }
            
            .stat-number { 
                font-size: 2.2rem; 
                font-weight: 700; 
                margin-bottom: 0.3rem; 
                color: #1e293b;
            }
            .stat-label { 
                color: #64748b; 
                font-size: 0.95rem; 
                font-weight: 500; 
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .feature-icon { 
                font-size: 2.5rem; 
                opacity: 0.8; 
            }
            
            .welcome-card { 
                background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); 
                color: white; 
                padding: 2rem; 
                border-radius: 20px; 
                margin-bottom: 2rem; 
                box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
                position: relative;
                overflow: hidden;
            }
            
            .welcome-card::before {
                content: '';
                position: absolute;
                top: -50%;
                right: -50%;
                width: 200%;
                height: 200%;
                background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
                animation: rotate 20s linear infinite;
            }
            
            @keyframes rotate {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
            
            .welcome-card h2 {
                font-weight: 700;
                margin-bottom: 0.5rem;
                position: relative;
            }
            
            .welcome-card p {
                opacity: 0.9;
                margin: 0;
                position: relative;
            }
            
            .recent-activity-item { 
                padding: 1rem 1.2rem; 
                border-bottom: 1px solid #e2e8f0; 
                transition: all 0.2s ease; 
            }
            
            .recent-activity-item:last-child {
                border-bottom: none;
            }
            
            .recent-activity-item:hover { 
                background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); 
                transform: translateX(5px);
            }
            
            .recent-activity-item h6 {
                color: #1e293b;
                font-weight: 600;
                margin-bottom: 0.25rem;
            }
            
            .progress { 
                height: 8px; 
                border-radius: 4px; 
                background-color: #e2e8f0;
                overflow: hidden;
            }
            
            .progress-bar {
                transition: width 1s ease;
            }
            
            .department-progress { 
                margin-bottom: 1.2rem; 
            }
            
            .department-progress .fw-medium {
                font-weight: 500;
                color: #334155;
            }
            
            .department-progress .text-muted {
                color: #64748b !important;
                font-size: 0.9rem;
            }
            
            /* Chart container */
            .chart-container {
                position: relative;
                height: 250px;
                width: 100%;
            }
            
            /* Custom card header */
            .card-header {
                background: white;
                border-bottom: 1px solid #e2e8f0;
                padding: 1.2rem 1.5rem;
            }
            
            .card-header h5 {
                color: #1e293b;
                font-weight: 600;
                font-size: 1.1rem;
                margin: 0;
            }
            
            .card-header i {
                color: #3b82f6;
            }
            
            /* Activity badge */
            .activity-badge {
                background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
                color: white;
                padding: 0.2rem 0.8rem;
                border-radius: 20px;
                font-size: 0.75rem;
                font-weight: 600;
            }
            
            /* User info section */
            .user-info-card {
                background: white;
                border-radius: 16px;
                padding: 1.2rem 1.5rem;
                margin-bottom: 1.5rem;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
                border-left: 5px solid #3b82f6;
            }
            
            .user-avatar {
                width: 48px;
                height: 48px;
                background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-size: 1.5rem;
                font-weight: 600;
            }
            
            .user-details h6 {
                color: #1e293b;
                font-weight: 600;
                margin-bottom: 0.25rem;
            }
            
            .user-details p {
                color: #64748b;
                font-size: 0.9rem;
                margin: 0;
            }
            
            /* Responsive */
            @media (max-width: 768px) {
                .stat-card {
                    margin-bottom: 1rem;
                }
                
                .welcome-card {
                    padding: 1.5rem;
                }
                
                .chart-container {
                    height: 200px;
                    margin-top: 1.5rem;
                }
            }
        </style>
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <!-- Welcome Card -->
        <div class="welcome-card">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h2 id="greeting">Welcome back!</h2>
                    <p class="mb-0">You have <span class="fw-bold" th:text="${totalEmployees}">0</span> employees in your organization. Track and manage them efficiently.</p>
                </div>
                <div class="col-md-4 text-end">
                    <i class="bi bi-stars feature-icon"></i>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row g-4 mb-4">
            <div class="col-xl-3 col-md-6">
                <div class="stat-card total">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-number" th:text="${totalEmployees}">0</div>
                            <div class="stat-label">Total Employees</div>
                        </div>
                        <div class="feature-icon text-primary">
                            <i class="bi bi-people-fill"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <div class="progress">
                            <div class="progress-bar bg-primary" style="width: 100%"></div>
                        </div>
                        <small class="text-muted mt-1 d-block">All departments</small>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="stat-card active">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-number" th:text="${activeEmployees}">0</div>
                            <div class="stat-label">Active Employees</div>
                        </div>
                        <div class="feature-icon text-success">
                            <i class="bi bi-person-check"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <div class="progress">
                            <div class="progress-bar bg-success" 
                                 th:style="'width: ' + ${totalEmployees > 0 ? (activeEmployees * 100.0 / totalEmployees) : 0} + '%'">
                            </div>
                        </div>
                        <small class="text-muted mt-1 d-block">
                            <span th:text="${totalEmployees > 0 ? T(java.lang.Math).round(activeEmployees * 100.0 / totalEmployees) : 0}">0</span>% of total
                        </small>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="stat-card leave">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-number" th:text="${onLeave}">0</div>
                            <div class="stat-label">On Leave</div>
                        </div>
                        <div class="feature-icon text-warning">
                            <i class="bi bi-calendar-event"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <div class="progress">
                            <div class="progress-bar bg-warning" 
                                 th:style="'width: ' + ${totalEmployees > 0 ? (onLeave * 100.0 / totalEmployees) : 0} + '%'">
                            </div>
                        </div>
                        <small class="text-muted mt-1 d-block">
                            <span th:text="${totalEmployees > 0 ? T(java.lang.Math).round(onLeave * 100.0 / totalEmployees) : 0}">0</span>% of total
                        </small>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="stat-card new">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-number" th:text="${newHires}">0</div>
                            <div class="stat-label">New Hires (30d)</div>
                        </div>
                        <div class="feature-icon text-info">
                            <i class="bi bi-person-plus"></i>
                        </div>
                    </div>
                    <div class="mt-3">
                        <div class="progress">
                            <div class="progress-bar bg-info" 
                                 th:style="'width: ' + ${totalEmployees > 0 ? (newHires * 100.0 / totalEmployees) : 0} + '%'">
                            </div>
                        </div>
                        <small class="text-muted mt-1 d-block">
                            <span th:text="${totalEmployees > 0 ? T(java.lang.Math).round(newHires * 100.0 / totalEmployees) : 0}">0</span>% of total
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area with Two Columns -->
        <div class="row">
            <!-- Left Column - Department Statistics -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header bg-white border-0">
                        <h5 class="card-title mb-0"><i class="bi bi-building text-primary me-2"></i> Department Statistics</h5>
                    </div>
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div th:each="dept : ${departmentStats}" class="department-progress">
                                    <div class="d-flex justify-content-between mb-1">
                                        <span class="fw-medium" th:text="${dept.key}">Dept</span>
                                        <span class="text-muted" th:text="${dept.value} + ' (' + ${sectionPercentages.get(dept.key)} + '%)'">0</span>
                                    </div>
                                    <div class="progress">
                                        <div class="progress-bar" 
                                            th:classappend="${dept.key == 'IT' ? 'bg-primary' : (dept.key == 'HR' ? 'bg-success' : (dept.key == 'Technical' ? 'bg-warning' : (dept.key == 'Design' ? 'bg-info' : (dept.key == 'Finance' ? 'bg-secondary' : 'bg-dark'))))}" 
                                            th:style="'width: ' + ${sectionPercentages.get(dept.key)} + '%'"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 text-center mt-4 mt-md-0">
                                <canvas id="departmentChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column - User Info and Recent Activities -->
            <div class="col-lg-4">
                <!-- Logged in as section -->
                <div class="user-info-card">
                    <div class="d-flex align-items-center">
                        <div class="user-avatar me-3">
                            <span th:text="${#strings.substring(authenticatedUser?.firstName, 0, 1)}">JD</span>
                        </div>
                        <div class="user-details">
                            <h6>Logged in as</h6>
                            <!-- <p class="fw-bold" th:text="${authenticatedUser?.firstName + ' ' + authenticatedUser?.lastName}">John Doe</p>
                            <p class="small" th:text="${authenticatedUser?.role}">Administrator</p> -->
                            <p class="fw-bold" >Administrator</p>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activities -->
                <div class="card">
                    <div class="card-header bg-white border-0">
                        <h5 class="card-title mb-0"><i class="bi bi-clock-history text-primary me-2"></i> Recent Activities</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            <div th:each="activity : ${recentActivities}" class="recent-activity-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1 fw-bold" th:text="${activity.key}">Name</h6>
                                    <small class="text-muted">Recent</small>
                                </div>
                                <p class="mb-0 text-muted small" th:text="${activity.value}">Activity detail</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <th:block layout:fragment="scripts">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            // 1. Set current date
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateElement = document.getElementById('currentDate');
            if(dateElement) dateElement.textContent = now.toLocaleDateString('en-US', options);
            
            // 2. Time-based greeting
            const hour = now.getHours();
            let greeting = hour < 12 ? 'Good Morning' : (hour < 18 ? 'Good Afternoon' : 'Good Evening');
            const greetingElement = document.getElementById('greeting');
            if(greetingElement) greetingElement.textContent = greeting + '!';
            
            // 3. Department Chart
            const chartCanvas = document.getElementById('departmentChart');
            if (chartCanvas) {
                const ctx = chartCanvas.getContext('2d');
                
                const stats = /*[[${departmentStats}]]*/ {};
                
                const labels = Object.keys(stats);
                const dataValues = labels.map(key => stats[key]);

                if (labels.length > 0) {
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: labels,
                            datasets: [{
                                data: dataValues,
                                backgroundColor: ['#667eea', '#28a745', '#ffc107', '#17a2b8', '#6c757d', '#fd7e14', '#20c997'],
                                borderWidth: 2,
                                borderColor: '#fff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false, 
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        padding: 15,
                                        usePointStyle: true,
                                        font: { size: 11 }
                                    }
                                }
                            },
                            cutout: '70%',
                            layout: { padding: { top: 20, bottom: 20 } }
                        }
                    });
                }
            }
        });
    </script>
    </th:block>

    <!-- Additional styles for custom colors -->
    <style>
        .bg-orange { background-color: #f97316 !important; }
        .bg-teal { background-color: #14b8a6 !important; }
        .bg-pink { background-color: #ec4899 !important; }
        .bg-purple { background-color: #8b5cf6 !important; }
        
        .text-orange { color: #f97316; }
        .text-teal { color: #14b8a6; }
        .text-pink { color: #ec4899; }
        .text-purple { color: #8b5cf6; }
    </style>
</body>
</html>